--// Airwalk Mobile Toggle (Rounded Button)
local Player = game.Players.LocalPlayer
local RunService = game:GetService("RunService")

local AirWPart = nil
local Connection = nil
local Active = false
local GuiClosed = false -- flag untuk menandai apakah user sudah menutup GUI

-- Buat GUI jika belum ada
local function CreateGui()
	if GuiClosed then return end -- jika user sudah close, jangan buat lagi
	if Player.PlayerGui:FindFirstChild("AirwalkGui") then return end
	
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "AirwalkGui"
	ScreenGui.ResetOnSpawn = false
	ScreenGui.Parent = Player:WaitForChild("PlayerGui")
	
	-- Tombol Airwalk (sekarang Jalan di Udara)
	local Button = Instance.new("TextButton")
	Button.Size = UDim2.new(0,140,0,50)
	Button.Position = UDim2.new(0,10,0,60)
	Button.BackgroundColor3 = Color3.fromRGB(0,0,0) -- hitam
	Button.BackgroundTransparency = 0.3
	Button.TextColor3 = Color3.fromRGB(255,255,255)
	Button.Font = Enum.Font.SourceSansBold
	Button.TextSize = 20
	Button.Text = "Jalan di Udara: OFF"
	Button.BorderSizePixel = 0
	Button.Parent = ScreenGui
	
	-- Rounded sudut tombol
	local ButtonCorner = Instance.new("UICorner")
	ButtonCorner.CornerRadius = UDim.new(0,15)
	ButtonCorner.Parent = Button
	
	-- Tombol X
	local CloseBtn = Instance.new("TextButton")
	CloseBtn.Size = UDim2.new(0,40,0,40)
	CloseBtn.Position = UDim2.new(0,160,0,65)
	CloseBtn.BackgroundColor3 = Color3.fromRGB(200,0,0)
	CloseBtn.BackgroundTransparency = 0.2
	CloseBtn.TextColor3 = Color3.fromRGB(255,255,255)
	CloseBtn.Font = Enum.Font.SourceSansBold
	CloseBtn.TextSize = 20
	CloseBtn.Text = "X"
	CloseBtn.BorderSizePixel = 0
	CloseBtn.Parent = ScreenGui
	
	-- Rounded sudut tombol X
	local CloseCorner = Instance.new("UICorner")
	CloseCorner.CornerRadius = UDim.new(1,0)
	CloseCorner.Parent = CloseBtn
	
	-- Fungsi aktifkan Airwalk
	local function EnableAirwalk()
		if Active then return end
		Active = true
		
		local Character = Player.Character
		local HRP = Character and Character:WaitForChild("HumanoidRootPart")
		local Humanoid = Character and Character:FindFirstChild("Humanoid")
		if not HRP or not Humanoid then return end
		
		-- Buat part untuk Airwalk
		AirWPart = Instance.new("Part")
		AirWPart.Size = Vector3.new(7, 2, 7)
		AirWPart.Anchored = true
		AirWPart.Transparency = 1
		AirWPart.Name = "Airwalk"
		AirWPart.CanCollide = true
		AirWPart.Parent = workspace
		
		-- Hitung offset aman
		local HRP_Y_Offset = HRP.Size.Y/2 + 0.5
		
		Connection = RunService.RenderStepped:Connect(function()
			if HRP and AirWPart then
				AirWPart.CFrame = HRP.CFrame - Vector3.new(0, HRP_Y_Offset, 0)
			end
		end)
		
		Button.Text = "Jalan di Udara: ON"
		Button.BackgroundColor3 = Color3.fromRGB(0,0,0)
	end
	
	-- Fungsi matikan Airwalk
	local function DisableAirwalk()
		if not Active then return end
		Active = false
		
		if Connection then
			Connection:Disconnect()
			Connection = nil
		end
		
		if AirWPart then
			AirWPart:Destroy()
			AirWPart = nil
		end
		
		Button.Text = "Jalan di Udara: OFF"
		Button.BackgroundColor3 = Color3.fromRGB(0,0,0)
	end
	
	-- Toggle saat tombol ditekan
	Button.MouseButton1Click:Connect(function()
		if Active then
			DisableAirwalk()
		else
			EnableAirwalk()
		end
	end)
	
	-- Tombol X: hapus GUI + matikan Airwalk + set flag
	CloseBtn.MouseButton1Click:Connect(function()
		DisableAirwalk()
		ScreenGui:Destroy()
		GuiClosed = true
	end)
end

-- Buat GUI saat pertama kali
CreateGui()

-- Biar tetap ada kalau respawn, tapi cek flag
Player.CharacterAdded:Connect(function()
	task.wait(1)
	CreateGui()
end)
